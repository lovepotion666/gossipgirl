<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin ‚Ä¢ Control Center</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=0">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:ital,opsz,wght@0,6..96,400..900;1,6..96,400..900&display=swap" rel="stylesheet">
    
    <style>
        :root { 
            /* iOS 26 Palette */
            --gold-primary: #D4AF37;
            --gold-dim: #8C701B;
            --red-neon: #FF3B30;
            --green-neon: #34C759;
            
            /* Glass Variables */
            --glass-surface: rgba(30, 30, 30, 0.70);
            --glass-border: rgba(255, 255, 255, 0.12);
            --glass-highlight: rgba(255, 255, 255, 0.2);
            --glass-shadow: 0 20px 40px -10px rgba(0,0,0,0.9);
            
            /* Backgrounds */
            --bg-dark: #000000;
            
            /* Physics */
            --ease-spring: cubic-bezier(0.175, 0.885, 0.32, 1.15);
        }
        
        * { box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; -webkit-tap-highlight-color: transparent; }
        
        @keyframes liquidReveal {
            0% { opacity: 0; transform: translateY(20px) scale(0.98); filter: blur(10px); }
            100% { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
        }

        body { 
            background: var(--bg-dark); color: #fff; margin: 0; 
            background-image: 
                radial-gradient(circle at 50% 0%, rgba(212, 175, 55, 0.15) 0%, transparent 60%),
                linear-gradient(to bottom, #111 0%, #000 100%);
            background-attachment: fixed; -webkit-font-smoothing: antialiased; 
            padding-bottom: 100px;
            animation: liquidReveal 0.6s ease forwards;
        }

        /* --- Components --- */

        .liquid-card { 
            background: var(--glass-surface); 
            backdrop-filter: blur(35px) saturate(180%); -webkit-backdrop-filter: blur(35px) saturate(180%); 
            border: 1px solid var(--glass-border); 
            border-top: 1px solid var(--glass-highlight); 
            border-radius: 32px; 
            box-shadow: var(--glass-shadow);
            position: relative; overflow: hidden;
            transition: transform 0.3s var(--ease-spring);
            transform: translateZ(0);
        }

        header { 
            position: sticky; top: 0; padding: 15px 24px; 
            background: rgba(10, 10, 10, 0.8); backdrop-filter: blur(40px); 
            border-bottom: 1px solid rgba(255,255,255,0.08); 
            display: flex; justify-content: space-between; align-items: center; z-index: 1000; 
        }

        .container { max-width: 600px; margin: 0 auto; padding: 25px; }
        
        .exit-link { 
            color: rgba(255,255,255,0.6); font-weight: 700; text-decoration: none; 
            font-size: 10px; letter-spacing: 1px; text-transform: uppercase;
            padding: 8px 16px; background: rgba(255,255,255,0.05); border-radius: 20px;
        }

        .admin-title { 
            font-family: 'Bodoni Moda', serif; font-style: italic; font-weight: 800; 
            font-size: 22px; color: var(--gold-primary); 
            text-shadow: 0 0 20px rgba(212,175,55,0.3);
        }

        .online-indicator { 
            background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); 
            padding: 6px 14px; border-radius: 100px; font-size: 11px; font-weight: 700; 
            display: flex; align-items: center; gap: 8px; color: #fff;
        }
        .dot { 
            width: 8px; height: 8px; background: var(--green-neon); border-radius: 50%; 
            box-shadow: 0 0 10px var(--green-neon); 
            animation: blink 2s infinite;
        }
        @keyframes blink { 0%,100% { opacity: 1; } 50% { opacity: 0.4; } }

        /* Tabs (Segmented Control) */
        .tabs { 
            display: flex; gap: 4px; margin-bottom: 30px; 
            background: rgba(255,255,255,0.08); padding: 4px; border-radius: 100px; 
            border: 1px solid rgba(255,255,255,0.05); 
        }
        .tab-btn { 
            flex: 1; padding: 10px; border-radius: 100px; border: none; 
            background: transparent; color: rgba(255,255,255,0.5); 
            font-weight: 700; font-size: 11px; cursor: pointer; 
            text-transform: uppercase; letter-spacing: 0.5px; transition: 0.3s; 
        }
        .tab-btn.active { 
            background: rgba(255,255,255,0.15); color: #fff; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); 
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Buttons & Inputs */
        .btn-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        
        .btn { 
            height: 44px; border-radius: 14px; border: none; font-weight: 800; cursor: pointer; 
            font-size: 11px; text-transform: uppercase; letter-spacing: 1px; 
            transition: 0.3s var(--ease-spring); 
            display: flex; align-items: center; justify-content: center; 
        }
        .btn:active { transform: scale(0.95); }
        
        .btn-pub { 
            background: rgba(52, 199, 89, 0.15); color: var(--green-neon); 
            border: 1px solid rgba(52, 199, 89, 0.4); 
            box-shadow: 0 0 15px rgba(52, 199, 89, 0.1);
        }
        .btn-burn { 
            background: rgba(255, 59, 48, 0.15); color: var(--red-neon); 
            border: 1px solid rgba(255, 59, 48, 0.4); 
            box-shadow: 0 0 15px rgba(255, 59, 48, 0.1);
        }
        .btn-ghost { 
            background: rgba(255,255,255,0.03); color: rgba(255,255,255,0.6); 
            border: 1px solid var(--glass-border); 
        }

        .tip-editor { 
            width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); 
            color: #fff; font-size: 15px; line-height: 1.5; resize: none; 
            padding: 16px; border-radius: 18px; outline: none; margin-bottom: 12px; 
            font-family: -apple-system, sans-serif;
            transition: 0.3s;
        }
        .tip-editor:focus { background: rgba(0,0,0,0.5); border-color: var(--gold-primary); }

        .tip-image-preview { 
            width: 100%; height: 200px; object-fit: cover; border-radius: 24px; 
            margin-bottom: 16px; border: 1px solid var(--glass-border); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Popups */
        .nuke-overlay { 
            position: fixed; inset: 0; background: rgba(0,0,0,0.85); 
            backdrop-filter: blur(40px); z-index: 10001; 
            display: none; align-items: center; justify-content: center; padding: 25px; 
        }
        .nuke-overlay.active { display: flex; animation: liquidReveal 0.4s var(--ease-spring); }

        .v-tag { 
            text-align: right; margin-top: 40px; font-size: 9px; font-weight: 700; 
            color: var(--gold-dim); letter-spacing: 2px; opacity: 0.5; 
        }
    </style>
</head>
<body>

<div id="deletePopup" class="nuke-overlay">
    <div class="liquid-card" style="padding: 35px; text-align: center; width: 100%; max-width: 350px;">
        <h2 style="color:var(--red-neon); font-weight: 800; margin-top: 0; margin-bottom: 25px;">Remove Post?</h2>
        <div class="btn-row">
            <button class="btn btn-ghost" onclick="closeDeletePopup()">Cancel</button>
            <button class="btn btn-burn" id="confirmDeleteBtn">Delete</button>
        </div>
    </div>
</div>

<header>
    <a href="index.html" class="exit-link">Exit</a>
    <div class="admin-title">Control Center</div>
    <div class="online-indicator"><div class="dot"></div><span id="userCount">0</span></div>
</header>

<div class="container">
    <div class="tabs">
        <button id="tabPending" class="tab-btn active" onclick="switchTab('pending')">Pending Tips</button>
        <button id="tabLive" class="tab-btn" onclick="switchTab('live')">Live Feed</button>
    </div>

    <div id="pendingSection">
        <div id="massActionContainer" class="btn-row" style="margin-bottom: 20px; display: none;">
            <button class="btn btn-burn" onclick="massAction('burn')">Burn All</button>
            <button class="btn btn-pub" onclick="massAction('pub')">Publish All</button>
        </div>
        
        <div id="pendingFeed"></div>
    </div>

    <div id="liveSection" style="display:none;">
        <div id="liveFeed"></div>
    </div>
    
    <div class="v-tag">V1.0 OFFICIAL</div>
</div>

<script>
(function() {
    const firebaseConfig = { 
        apiKey: "AIzaSyCTdVcJspQxXiq_Kd7ImL32xWsjv0HgENE", 
        authDomain: "gossip-girl-4c9f2.firebaseapp.com", 
        projectId: "gossip-girl-4c9f2", 
        databaseURL: "https://gossip-girl-4c9f2-default-rtdb.firebaseio.com" 
    };

    if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentTipsData = {};
    let postToDelete = null;

    window.switchTab = function(tab) {
        document.getElementById('pendingSection').style.display = tab === 'pending' ? 'block' : 'none';
        document.getElementById('liveSection').style.display = tab === 'live' ? 'block' : 'none';
        document.getElementById('tabPending').classList.toggle('active', tab === 'pending');
        document.getElementById('tabLive').classList.toggle('active', tab === 'live');
    };

    // --- PENDING TIPS LOGIC ---
    db.ref('tips').on('value', s => {
        const data = s.val() || {};
        currentTipsData = data;
        const feed = document.getElementById('pendingFeed');
        const massAction = document.getElementById('massActionContainer');
        const keys = Object.keys(data).reverse();
        
        // Toggle mass action buttons visibility
        if (massAction) {
            massAction.style.display = keys.length > 0 ? 'grid' : 'none';
        }

        if (keys.length === 0) {
            feed.innerHTML = `<div style="text-align:center; opacity:0.3; padding:60px 20px; font-weight:600; letter-spacing:1px; color:var(--gold-primary);">No pending tips...</div>`;
            return;
        }

        feed.innerHTML = keys.map(id => {
            const t = data[id];
            return `
                <div class="liquid-card" style="padding:20px; margin-bottom:20px; animation: liquidReveal 0.5s var(--ease-spring);">
                    ${t.image ? `<img src="${t.image}" class="tip-image-preview">` : ''}
                    <textarea class="tip-editor" id="edit-${id}" spellcheck="false">${t.text || ''}</textarea>
                    <div class="btn-row">
                        <button class="btn btn-burn" onclick="burnTip('${id}')">Burn</button>
                        <button class="btn btn-pub" onclick="pubTip('${id}')">Publish</button>
                    </div>
                </div>`;
        }).join('');
    });

    window.burnTip = (id) => db.ref('tips/'+id).remove();

    window.pubTip = async function(id) {
        const editEl = document.getElementById('edit-'+id);
        const text = editEl ? editEl.value : (currentTipsData[id]?.text || "");
        const t = currentTipsData[id];
        if(!t) return;

        try {
            await db.ref('posts').push({
                text: text,
                image: t.image || '',
                date: firebase.database.ServerValue.TIMESTAMP,
                views: 0,
                verifyCount: 0
            });
            return db.ref('tips/'+id).remove();
        } catch (e) {
            console.error("Publish failed", e);
        }
    };

    window.massAction = async (action) => {
        const keys = Object.keys(currentTipsData);
        if (keys.length === 0) return;
        
        const promises = keys.map(id => {
            if(action === 'pub') return pubTip(id);
            else return burnTip(id);
        });
        
        await Promise.all(promises);
    };

    // --- LIVE FEED LOGIC ---
    db.ref('posts').on('value', s => {
        const data = s.val() || {};
        const feed = document.getElementById('liveFeed');
        const keys = Object.keys(data).reverse();
        
        if (keys.length === 0) {
            feed.innerHTML = `<div style="text-align:center; opacity:0.3; padding:60px 20px;">Feed is empty...</div>`;
            return;
        }

        feed.innerHTML = keys.map(id => `
            <div class="liquid-card" style="padding:20px; margin-bottom:15px;">
                <div style="font-size:14px; margin-bottom:15px; opacity:0.9; line-height:1.5; font-weight:400;">${data[id].text || '(No text)'}</div>
                <div style="display:flex; justify-content:space-between; align-items:center; border-top:1px solid rgba(255,255,255,0.05); padding-top:12px;">
                    <span style="font-size:10px; color:var(--gold-primary); font-weight:700;">üëÅ ${data[id].views || 0} READS</span>
                    <button class="btn btn-burn" style="height:32px; padding:0 16px; width: auto; font-size:9px;" onclick="openDeletePopup('${id}')">DELETE</button>
                </div>
            </div>
        `).join('');
    });

    window.openDeletePopup = (id) => {
        postToDelete = id;
        document.getElementById('deletePopup').classList.add('active');
    };

    window.closeDeletePopup = () => {
        postToDelete = null;
        document.getElementById('deletePopup').classList.remove('active');
    };

    document.getElementById('confirmDeleteBtn').onclick = async () => {
        if(postToDelete) {
            await db.ref('posts/'+postToDelete).remove();
            await db.ref('comments/'+postToDelete).remove();
            closeDeletePopup();
        }
    };

    // --- USER COUNT ---
    const statusId = Math.random().toString(36).substr(2, 9);
    const statusRef = db.ref('/status/' + statusId);
    statusRef.onDisconnect().remove().then(() => statusRef.set(true));
    db.ref('/status').on('value', s => { 
        const count = s.numChildren();
        document.getElementById('userCount').innerText = count; 
    });
})();
</script>
</body>
</html>